{% extends 'base.html' %}

{% block content %}
  <!-- CSSファイルの読み込み -->
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/artwork_form.css' %}">

  <h2>作品を投稿</h2>
  
  <!-- 全体のコンテナ -->
  <div class="artwork-form-container">
    
    <!-- 左側のメディアセクション -->
    <div class="media-section">
      <label for="image">写真や動画を添付</label>
      {{ form.image }}
      <!-- 画像・動画プレビューを表示するためのエリア -->
      <div id="media-preview"></div> <!-- ここに画像・動画のプレビューが表示される -->
    </div>
    
    <!-- 右側のフォームセクション -->
    <div class="form-section">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="form-group">
          <label for="child">子供の名前</label>
          {{ form.child }}
        </div>
        
        <div class="form-group">
          <label for="creation_date">作成日</label>
          {{ form.creation_date }}
        </div>
        
        <div class="form-group">
          <label for="title">作品名</label>
          {{ form.title }}
        </div>
        
        <div class="form-group">
          <label for="comment">コメント・感想</label>
          {{ form.comment }}
        </div>
        
        <!-- 投稿ボタン -->
        <button type="submit" class="submit-button">投稿</button>
      </form>
    </div>
  </div>

  <!-- JavaScriptを使って画像・動画プレビューを表示 -->
  <script>
    document.getElementById("id_image").addEventListener("change", function () {
        var previewContainer = document.getElementById("media-preview");
        var files = this.files;

        // プレビューをクリア
        previewContainer.innerHTML = "";

        // 選択されたファイルを1つずつ処理
        for (var i = 0; i < files.length; i++) {
            var file = files[i];

            // 画像ファイルの場合
            if (file.type.startsWith('image/')) {
                var img = document.createElement('img');
                img.style.maxWidth = '200px'; // プレビュー画像の最大幅
                img.style.margin = '10px';

                var reader = new FileReader();
                reader.onload = function(e) {
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);

                previewContainer.appendChild(img);
            }

            // 動画ファイルの場合
            if (file.type.startsWith('video/')) {
                var video = document.createElement('video');
                video.style.maxWidth = '200px'; // プレビュー動画の最大幅
                video.style.margin = '10px';
                video.controls = true;

                var reader = new FileReader();
                reader.onload = function(e) {
                    video.src = e.target.result;
                };
                reader.readAsDataURL(file);

                previewContainer.appendChild(video);
            }
        }
    });
  </script>
{% endblock %}

